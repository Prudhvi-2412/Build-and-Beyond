<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interior Design Request Form | Build & Beyond</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #1e293b;
            --accent: #facc15;
            --gray: #e2e8f0;
            --text-secondary: #475569;
        }

        body {
            @apply bg-gray-50 text-gray-900 min-h-screen flex items-center justify-center p-4;
        }

        .container {
            @apply max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-lg;
        }

        .page-title {
            @apply text-center mb-8;
        }

        .page-title h1 {
            @apply text-2xl md:text-3xl font-bold text-primary;
        }

        .page-title .underline {
            @apply w-24 h-1 bg-gradient-to-r from-accent to-primary mx-auto mt-2 rounded;
        }

        .section {
            @apply mb-6 pb-6 border-b border-gray-200;
        }

        .section-title {
            @apply text-xl font-semibold text-primary mb-4 relative;
        }

        .section-title::after {
            @apply absolute bottom-0 left-0 w-12 h-1 bg-accent rounded;
            content: '';
        }

        .form-grid {
            @apply grid gap-4 md:grid-cols-2;
        }

        .form-group {
            @apply mb-4;
        }

        label {
            @apply block mb-2 font-medium text-text-secondary;
        }

        label.required::after {
            content: '*';
            @apply text-accent ml-1;
        }

        input, select, textarea {
            @apply w-full p-3 border-2 border-gray rounded-lg text-primary bg-white focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all;
        }

        textarea {
            @apply min-h-[100px] resize-y;
        }

        select {
            @apply h-12;
        }

        .room-selector {
            @apply grid gap-3 sm:grid-cols-2 md:grid-cols-3 mt-2;
        }

        .room-option input[type="radio"] {
            @apply hidden;
        }

        .room-option label {
            @apply block p-3 bg-gray-50 border-2 border-gray-200 rounded-lg text-center text-text-secondary cursor-pointer hover:bg-gray-100 transition-all;
        }

        .room-option input[type="radio"]:checked + label {
            @apply border-accent bg-accent/10 text-primary font-semibold;
        }

        .dimension-inputs {
            @apply flex gap-2 items-center;
        }

        .dimension-inputs .dimension-unit {
            @apply w-24;
        }

        .file-upload {
            @apply mt-2;
        }

        .file-upload-label {
            @apply flex flex-col items-center justify-center h-28 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 text-text-secondary cursor-pointer hover:border-accent hover:bg-gray-100 transition-all;
        }

        .file-upload-label i {
            @apply text-2xl mb-2;
        }

        .file-upload input[type="file"] {
            @apply hidden;
        }

        .image-section {
            @apply p-4 border border-gray-200 rounded-lg bg-gray-50 mb-4;
        }

        .image-section h3 {
            @apply text-base font-semibold text-primary mb-2;
        }

        .image-section p {
            @apply text-sm text-text-secondary mb-3;
        }

        .preview-container {
            @apply flex flex-wrap gap-3 mt-3;
        }

        .preview-item {
            @apply relative w-24 h-24 rounded overflow-hidden shadow-sm;
        }

        .preview-item img {
            @apply w-full h-full object-cover;
        }

        .preview-item .remove-btn {
            @apply absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-sm cursor-pointer hover:bg-red-600 transition-all;
        }

        .btn-submit {
            @apply bg-accent text-primary px-8 py-3 rounded-full font-semibold hover:bg-yellow-500 hover:shadow-lg transition-all block mx-auto mt-6;
        }

        .success-message, .error-message {
            @apply hidden text-center p-4 rounded-lg mt-4 font-medium;
        }

        .success-message {
            @apply bg-green-100 text-green-800;
        }

        .error-message {
            @apply bg-red-100 text-red-800;
        }

        @media (max-width: 640px) {
            .container {
                @apply p-4;
            }

            .form-grid, .room-selector {
                @apply grid-cols-1;
            }

            .page-title h1 {
                @apply text-xl;
            }

            .section-title {
                @apply text-lg;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-title">
            <h1>Interior Design Request Form</h1>
            <div class="underline"></div>
        </div>

        <form id="designRequestForm" enctype="multipart/form-data" action="/design_submit" method="post">
            <input type="hidden" id="workerId" name="workerId" value="">

            <!-- Customer Details -->
            <div class="section">
                <h2 class="section-title">Customer Details</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="projectName" class="required">Project Name</label>
                        <input type="text" id="projectName" name="projectName" required aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="fullName" class="required">Full Name</label>
                        <input type="text" id="fullName" name="fullName" required aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="email" class="required">Email Address</label>
                        <input type="email" id="email" name="email" required aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="phone" class="required">Phone Number</label>
                        <input type="tel" id="phone" name="phone" required aria-required="true" pattern="[0-9]{10,}" title="Please enter a valid phone number">
                    </div>
                </div>
                <div class="form-group">
                    <label for="address" class="required">Home Address</label>
                    <input type="text" id="address" name="address" required aria-required="true">
                </div>
            </div>

            <!-- Project Details -->
            <div class="section">
                <h2 class="section-title">Project Details</h2>
                <div class="form-group">
                    <label for="roomType" class="required">Room Type</label>
                    <div class="room-selector" id="roomTypeSelector">
                        <div class="room-option">
                            <input type="radio" id="kitchen" name="roomType" value="Kitchen" required aria-required="true">
                            <label for="kitchen">Kitchen</label>
                        </div>
                        <div class="room-option">
                            <input type="radio" id="livingRoom" name="roomType" value="Living Room">
                            <label for="livingRoom">Living Room</label>
                        </div>
                        <div class="form-group">
                            <input type="radio" id="bedroom" name="roomType" value="Bedroom">
                            <label for="bedroom">Bedroom</label>
                        </div>
                        <div class="room-option">
                            <input type="radio" id="bathroom" name="roomType" value="Bathroom">
                            <label for="bathroom">Bathroom</label>
                        </div>
                        <div class="room-option">
                            <input type="radio" id="diningRoom" name="roomType" value="Dining Room">
                            <label for="diningRoom">Dining Room</label>
                        </div>
                        <div class="room-option">
                            <input type="radio" id="otherRoom" name="roomType" value="Other">
                            <label for="otherRoom">Other</label>
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="roomSize" class="required">Room Size</label>
                        <div class="dimension-inputs">
                            <input type="number" id="roomLength" name="roomLength" placeholder="Length" min="1" step="0.01" required aria-required="true">
                            <span>×</span>
                            <input type="number" id="roomWidth" name="roomWidth" placeholder="Width" min="1" step="0.01" required aria-required="true">
                            <select id="dimensionUnit" name="dimensionUnit" class="dimension-unit">
                                <option value="feet">feet</option>
                                <option value="meters">meters</option>
                            </select>
                        </div>
                        <p class="text-sm text-text-secondary mt-1">Enter approximate room dimensions</p>
                    </div>
                    <div class="form-group">
                        <label for="ceilingHeight">Ceiling Height (optional)</label>
                        <div class="dimension-inputs">
                            <input type="number" id="ceilingHeight" name="ceilingHeight" placeholder="Height" min="1" step="0.01">
                            <select id="heightUnit" name="heightUnit" class="dimension-unit">
                                <option value="feet">feet</option>
                                <option value="meters">meters</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="designPreference">Design Preference (optional)</label>
                    <select id="designPreference" name="designPreference">
                        <option value="">Select a style</option>
                        <option value="Modern">Modern</option>
                        <option value="Traditional">Traditional</option>
                        <option value="Scandinavian">Scandinavian</option>
                        <option value="Industrial">Industrial</option>
                        <option value="Bohemian">Bohemian</option>
                        <option value="Minimalist">Minimalist</option>
                        <option value="Rustic">Rustic</option>
                        <option value="Contemporary">Contemporary</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="projectDescription">Project Description (optional)</label>
                    <textarea id="projectDescription" name="projectDescription" placeholder="Tell us more about your vision for this space..."></textarea>
                </div>
            </div>

            <!-- Upload Photos -->
            <div class="section">
                <h2 class="section-title">Upload Photos</h2>
                <div class="image-section">
                    <h3>Current Room Photos</h3>
                    <p class="text-sm text-text-secondary">Upload photos of your current space to help our designers understand its layout and style.</p>
                    <div class="file-upload">
                        <label class="file-upload-label" for="currentRoomImages">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            <span>Upload current room photos</span>
                            <small>(Max 3 images, JPG/PNG)</small>
                        </label>
                        <input type="file" id="currentRoomImages" name="currentRoomImages" accept="image/jpeg,image/png" multiple>
                    </div>
                    <div class="preview-container" id="currentRoomPreview"></div>
                </div>

                <div class="image-section">
                    <h3>Design Inspiration</h3>
                    <p class="text-sm text-text-secondary">Share images of designs, colors, or furniture styles you like to help us understand your preferences.</p>
                    <div class="file-upload">
                        <label class="file-upload-label" for="inspirationImages">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            <span>Upload inspiration images</span>
                            <small>(Max 3 images, JPG/PNG)</small>
                        </label>
                        <input type="file" id="inspirationImages" name="inspirationImages" accept="image/jpeg,image/png" multiple>
                    </div>
                    <div class="preview-container" id="inspirationPreview"></div>
                </div>
            </div>

            <button type="submit" class="btn-submit">Submit Request</button>
        </form>

        <div class="success-message" id="successMessage">
            <h2>Request Submitted Successfully!</h2>
            <p>One of our designers will contact you within 48 hours to discuss your project.</p>
        </div>
        <div class="error-message" id="errorMessage">
            <p id="errorText"></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize workerId from URL
            const urlParams = new URLSearchParams(window.location.search);
            const workerId = urlParams.get('workerId');
            if (workerId) {
                document.getElementById('workerId').value = workerId;
            }

            // File upload handling
            const fileInputs = ['currentRoomImages', 'inspirationImages'];
            fileInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                const previewContainer = document.getElementById(inputId.replace('Images', 'Preview'));
                
                input?.addEventListener('change', (event) => {
                    const maxFiles = 3;
                    const maxFileSize = 5 * 1024 * 1024; // 5MB
                    const allowedTypes = ['image/jpeg', 'image/png'];
                    const files = Array.from(event.target.files);

                    if (files.length > maxFiles) {
                        alert(`You can only upload a maximum of ${maxFiles} images.`);
                        input.value = '';
                        previewContainer.innerHTML = '';
                        return;
                    }

                    previewContainer.innerHTML = '';
                    files.forEach((file, index) => {
                        if (file.size > maxFileSize) {
                            alert(`File ${file.name} exceeds 5MB limit.`);
                            return;
                        }
                        if (!allowedTypes.includes(file.type)) {
                            alert(`File ${file.name} is not a valid type (JPG, PNG only).`);
                            return;
                        }

                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        const removeButton = document.createElement('button');
                        removeButton.className = 'remove-btn';
                        removeButton.textContent = '×';
                        removeButton.setAttribute('aria-label', `Remove ${file.name}`);

                        removeButton.addEventListener('click', () => {
                            const dt = new DataTransfer();
                            files.filter(f => f !== file).forEach(f => dt.items.add(f));
                            input.files = dt.files;
                            previewContainer.removeChild(previewItem);
                        });

                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.alt = file.name;
                            previewItem.append(img, removeButton);
                            previewContainer.appendChild(previewItem);
                        };
                        reader.readAsDataURL(file);
                    });
                });
            });

            // Sync dimension units
            const dimensionUnit = document.getElementById('dimensionUnit');
            const heightUnit = document.getElementById('heightUnit');
            dimensionUnit?.addEventListener('change', () => heightUnit.value = dimensionUnit.value);
            heightUnit?.addEventListener('change', () => dimensionUnit.value = heightUnit.value);

            // Form submission with validation
            const form = document.getElementById('designRequestForm');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                let allValid = true;

                // Validate required fields
                form.querySelectorAll('[required]').forEach(field => {
                    if (!field.value.trim()) {
                        allValid = false;
                        field.classList.add('border-red-500');
                    } else {
                        field.classList.remove('border-red-500');
                    }
                });

                // Validate room type
                const roomTypeSelected = form.querySelector('input[name="roomType"]:checked');
                const roomTypeSelector = document.getElementById('roomTypeSelector');
                if (!roomTypeSelected) {
                    allValid = false;
                    roomTypeSelector.classList.add('border-red-500');
                } else {
                    roomTypeSelector.classList.remove('border-red-500');
                }

                if (!allValid) {
                    errorMessage.classList.remove('hidden');
                    errorText.textContent = 'Please fill in all required fields.';
                    successMessage.classList.add('hidden');
                    return;
                }

                try {
                    const formData = new FormData(form);
                    const response = await fetch('/design_submit', {
                        method: 'POST',
                        body: formData,
                    });

                    const result = await response.json();
                    if (response.ok) {
                        form.classList.add('hidden');
                        successMessage.classList.remove('hidden');
                        errorMessage.classList.add('hidden');
                    } else {
                        errorMessage.classList.remove('hidden');
                        errorText.textContent = result.error || 'An error occurred. Please try again.';
                        successMessage.classList.add('hidden');
                    }
                } catch (error) {
                    errorMessage.classList.remove('hidden');
                    errorText.textContent = 'Network error. Please check your connection and try again.';
                    successMessage.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>